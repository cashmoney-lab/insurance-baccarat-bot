<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Insurance Baccarat Bot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

{% if not autorizado %}
<div class="login-box">
    <h2>ğŸ” Acesso Restrito</h2>
    <form method="POST">
        <input type="password" name="pin" placeholder="Digite o PIN" required>
        <button type="submit">Entrar</button>
    </form>
    {% if erro %}
        <p class="erro">{{ erro }}</p>
    {% endif %}
</div>
{% else %}

<header>
    <h1>ğŸ° Insurance Baccarat Bot</h1>
    <p>Bot profissional com proteÃ§Ã£o no empate</p>
</header>

<div id="timer" class="timer">
    â±ï¸ Tempo restante: --:--:--
</div>

<div class="buttons">
    <button onclick="addResult('B')">BANKER</button>
    <button onclick="addResult('P')">PLAYER</button>
</div>

<div id="status" class="status wait">â³ Aguardando resultados...</div>
<div id="signal" class="signal"></div>

<h3>ğŸ“œ HistÃ³rico</h3>
<ul id="historyList"></ul>

<script>
let history = [];
let remainingSeconds = {{ remaining }};

function formatTime(seconds) {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updateTimer() {
    const timer = document.getElementById("timer");

    if (remainingSeconds <= 0) {
        location.reload();
        return;
    }

    timer.innerHTML = "â±ï¸ Tempo restante: " + formatTime(remainingSeconds);

    if (remainingSeconds < 120) {
        timer.className = "timer danger";
    } else if (remainingSeconds < 600) {
        timer.className = "timer warning";
    }

    remainingSeconds--;
}

setInterval(updateTimer, 1000);

function addResult(r) {
    history.push(r);

    const list = document.getElementById("historyList");
    const item = document.createElement("li");
    item.textContent = new Date().toLocaleTimeString() + " â†’ " + r;
    list.prepend(item);

    if (history.length >= 3) analyze();
}

function analyze() {
    const last = history.slice(-3).join("");
    const status = document.getElementById("status");
    const signal = document.getElementById("signal");

    if (last === "BBB") {
        status.className = "status win";
        status.innerHTML = "ğŸ˜„ğŸ”¥ ENTRAR AGORA";
        signal.innerHTML = "ğŸŸ¢ APOSTAR BANKER <br> ğŸ›¡ï¸ EMPATE";
    }
    else if (last === "PPP") {
        status.className = "status win";
        status.innerHTML = "ğŸ˜„ğŸ”¥ ENTRAR AGORA";
        signal.innerHTML = "ğŸŸ¢ APOSTAR PLAYER <br> ğŸ›¡ï¸ EMPATE";
    }
    else {
        status.className = "status wait";
        status.innerHTML = "ğŸ˜â›” AGUARDAR";
        signal.innerHTML = "";
    }
}
</script>

{% endif %}

</body>
</html>
